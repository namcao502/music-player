<div class="trending-page">
  <header class="header">
    <h1>{{ strings.PAGE.TRENDING_TITLE }}</h1>
    <p class="subtitle">{{ strings.PAGE.TRENDING_SUBTITLE }}</p>
  </header>

  <div class="genre-chips">
    <button type="button" class="genre-chip" [class.active]="selectedGenre() === null" (click)="selectGenre(null)">{{ strings.LABEL.ALL }}</button>
    @for (genre of genres; track genre) {
      <button type="button" class="genre-chip" [class.active]="selectedGenre() === genre" (click)="selectGenre(genre)">{{ genre }}</button>
    }
  </div>

  @if (loading()) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>{{ strings.LOADING.TRENDING }}</p>
    </div>
  } @else if (error()) {
    <div class="error-state">
      <p class="error-message">{{ error() }}</p>
    </div>
  } @else if (tracks().length > 0) {
    <ul class="track-list">
      @for (track of tracks(); track track.id; let i = $index) {
        <li class="track-item" (click)="onTrackClick(track)" role="button" tabindex="0" (keydown.enter)="onTrackClick(track)">
          <span class="track-index">{{ i + 1 }}</span>
          <div class="track-cover">
            @if (brokenCoverIds().has(track.id)) {
              <span class="cover-fallback">â™ª</span>
            } @else {
              <img [src]="artworkUrl(track)" [alt]="track.title" (error)="onCoverError(track.id)" />
            }
          </div>
          <div class="track-info">
            <span class="track-title">{{ track.title }}</span>
            @if (track.user?.name) {
              <a class="track-artist artist-link" [routerLink]="['/artist', track.user!.id]" (click)="$event.stopPropagation()">{{ track.user?.name }}</a>
            }
          </div>
          <span class="track-duration">{{ formatDuration(track.duration) }}</span>
          <button
            type="button"
            class="queue-btn"
            (click)="addToQueue(track, $event)"
            [attr.aria-label]="strings.BTN.ADD_TO_QUEUE"
            [attr.title]="strings.BTN.ADD_TO_QUEUE"
          >
            <svg class="icon-queue" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
          </button>
          <button
            type="button"
            class="share-btn"
            (click)="shareTrack(track.id, $event)"
            [attr.aria-label]="strings.BTN.SHARE_TRACK"
            [attr.title]="strings.BTN.SHARE_TRACK"
          >
            <svg class="icon-share" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
          </button>
          <button
            type="button"
            class="fav-btn"
            [class.is-fav]="favoritesService.isFavorite(track.id)"
            (click)="toggleFavorite(track.id, $event)"
            [attr.aria-label]="favoritesService.isFavorite(track.id) ? strings.LABEL_FAVORITES.REMOVE : strings.LABEL_FAVORITES.ADD"
          >
            <svg class="icon-heart" viewBox="0 0 24 24" aria-hidden="true">
              @if (favoritesService.isFavorite(track.id)) {
                <path fill="currentColor" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              } @else {
                <path fill="none" stroke="currentColor" stroke-width="2" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              }
            </svg>
          </button>
        </li>
      }
    </ul>
  } @else {
    <p class="empty">{{ strings.EMPTY.TRENDING }}</p>
  }
</div>
