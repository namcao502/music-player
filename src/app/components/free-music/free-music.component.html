<div class="free-music">
  <header class="header">
    <h1>Free Music</h1>
    <p class="subtitle">Search and play royalty-free tracks from Audius (no copyright)</p>
    <div class="search-row">
      <input
        type="text"
        class="search-input"
        placeholder="Search tracks, artists..."
        [ngModel]="query()"
        (ngModelChange)="query.set($event)"
        (keyup.enter)="onSearch()"
      />
      <button type="button" class="search-btn" (click)="onSearch()">Search</button>
    </div>
    @if (recentSearches().length > 0) {
      <div class="recent-searches">
        <span class="recent-label">Recent:</span>
        @for (term of recentSearches(); track term) {
          <button type="button" class="recent-chip" (click)="runRecentSearch(term)">
            {{ term }}
          </button>
        }
      </div>
    }
  </header>

  @if (error()) {
    <p class="error">{{ error() }}</p>
  }

  @if (loading()) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>Searching…</p>
    </div>
  } @else if (tracks().length > 0) {
    <section class="section">
      <h2 class="section-title">Results</h2>
      <div class="grid tracks-grid">
        @for (track of tracks(); track track.id) {
          <button type="button" class="track-card" (click)="play(track)">
            <div class="cover-wrap">
              @if (brokenCoverIds().has(track.id)) {
                <div class="cover-fallback" aria-hidden="true">♪</div>
              } @else {
                <img [src]="artworkUrl(track)" [alt]="track.title" class="cover" (error)="onCoverError(track.id)" />
              }
              <span class="play-overlay">▶</span>
            </div>
            <span class="name">{{ track.title }}</span>
            @if (track.user?.name) {
              <span class="artist">{{ track.user?.name }}</span>
            }
            <span class="duration">{{ formatDuration(track.duration) }}</span>
          </button>
        }
      </div>
    </section>
  } @else if (query()) {
    <p class="empty">No tracks found. Try another search.</p>
  } @else {
    <p class="empty">Enter a search term and click Search to find free music.</p>
  }
</div>
