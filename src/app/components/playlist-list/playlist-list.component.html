<div class="playlist-list">
  <header class="header">
    <h1>{{ strings.PAGE.PLAYLISTS_TITLE }}</h1>
    <p class="subtitle">{{ strings.PAGE.PLAYLISTS_SUBTITLE }}</p>
    <div class="header-actions">
      <button type="button" class="btn-primary" (click)="createPlaylist()">{{ strings.BTN.NEW_PLAYLIST }}</button>
      <button type="button" class="btn-secondary" (click)="importPlaylist()">{{ strings.BTN.IMPORT }}</button>
    </div>
    @if (importError()) {
      <p class="import-error">{{ importError() }}</p>
    }
  </header>

  <!-- F8: Tag filter chips -->
  @if (usedTags().length > 0) {
    <div class="tag-filter-row">
      <span class="tag-filter-label">{{ strings.LABEL.FILTER }}:</span>
      <button type="button" class="tag-filter-chip" [class.active]="filterTag() === null" (click)="setFilterTag(null)">{{ strings.LABEL.ALL }}</button>
      @for (tag of usedTags(); track tag) {
        <button type="button" class="tag-filter-chip" [class.active]="filterTag() === tag" (click)="setFilterTag(tag)">
          <span class="tag-dot" [style.background]="getTagColor(tag)"></span>
          {{ tag }}
        </button>
      }
    </div>
  }

  @if (playlistService.playlistsList().length > 0 && filteredPlaylists().length > 0) {
    <div class="sort-row">
      <span class="sort-label">{{ strings.LABEL.SORT }}</span>
      <button type="button" class="sort-chip" [class.active]="sortBy() === 'name'" (click)="setSortBy('name')">{{ strings.SORT.NAME }}</button>
      <button type="button" class="sort-chip" [class.active]="sortBy() === 'count'" (click)="setSortBy('count')">{{ strings.SORT.TRACK_COUNT }}</button>
    </div>
  }

  @if (playlistService.playlistsList().length === 0) {
    <p class="empty">{{ strings.EMPTY.PLAYLISTS }}</p>
  } @else if (filteredPlaylists().length === 0) {
    <p class="empty">{{ strings.EMPTY.PLAYLISTS_TAG_FILTER }}</p>
  } @else {
    <ul class="list">
      @for (p of sortedPlaylists(); track p.id) {
        <li class="list-item">
          <button type="button" class="item-main" (click)="open(p.id)">
            <span class="item-name">{{ p.name }}</span>
            <span class="item-count">{{ strings.PLURAL.TRACKS(p.trackIds.length) }}</span>
            <!-- F8: Tag badges -->
            @if ((p.tags ?? []).length > 0) {
              <span class="item-tags">
                @for (tag of p.tags ?? []; track tag) {
                  <span class="tag-badge" [style.border-color]="getTagColor(tag)">
                    <span class="tag-dot" [style.background]="getTagColor(tag)"></span>
                    {{ tag }}
                    <button type="button" class="tag-remove" (click)="removeTagFromPlaylist(p.id, tag, $event)" [attr.aria-label]="strings.BTN.REMOVE_TAG" title="{{ strings.BTN.REMOVE_TAG }}">×</button>
                  </span>
                }
              </span>
            }
          </button>
          <div class="item-actions">
            <button type="button" class="btn-icon" (click)="play(p.id); $event.stopPropagation()" [disabled]="p.trackIds.length === 0" [attr.title]="strings.BTN.PLAY" [attr.aria-label]="strings.BTN.PLAY">▶</button>
            <!-- F8: Tag menu button -->
            <div class="tag-menu-wrap">
              <button type="button" class="btn-icon btn-tag" (click)="openTagMenu(p.id, $event)" [attr.title]="strings.BTN.MANAGE_TAGS" [attr.aria-label]="strings.BTN.MANAGE_TAGS">
                <svg class="icon-tag" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
              </button>
              @if (tagMenuPlaylistId() === p.id) {
                <div class="tag-menu" (click)="$event.stopPropagation()">
                  <p class="tag-menu-title">{{ strings.SECTION.TAGS }}</p>
                  @for (tag of presetTags; track tag) {
                    <button type="button" class="tag-menu-item" (click)="toggleTag(p.id, tag)">
                      <span class="tag-dot" [style.background]="getTagColor(tag)"></span>
                      {{ tag }}
                      @if ((p.tags ?? []).includes(tag)) {
                        <span class="tag-check">✓</span>
                      }
                    </button>
                  }
                </div>
              }
            </div>
            <button type="button" class="btn-icon" (click)="duplicatePlaylist(p.id, $event)" [attr.title]="strings.BTN.DUPLICATE" [attr.aria-label]="strings.BTN.DUPLICATE">⎘</button>
            <button type="button" class="btn-icon" (click)="rename(p); $event.stopPropagation()" [attr.title]="strings.BTN.RENAME" [attr.aria-label]="strings.BTN.RENAME">✎</button>
            <button type="button" class="btn-icon" (click)="delete(p.id, p.name); $event.stopPropagation()" [attr.title]="strings.BTN.DELETE" [attr.aria-label]="strings.BTN.DELETE">×</button>
          </div>
        </li>
      }
    </ul>
  }
</div>
