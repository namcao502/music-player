<div class="history-page">
  <header class="header">
    <h1>{{ strings.PAGE.HISTORY_TITLE }}</h1>
    <p class="subtitle">{{ strings.PAGE.HISTORY_SUBTITLE }}</p>
    @if (historyService.historyList().length > 0) {
      <button type="button" class="btn-clear" (click)="clearHistory()">{{ strings.BTN.CLEAR_HISTORY }}</button>
    }
  </header>

  @if (historyService.historyList().length === 0) {
    <p class="empty">{{ strings.EMPTY.HISTORY }}</p>
  } @else {
    @if (recentArtists().length > 0) {
      <section class="recent-artists-section">
        <h2 class="section-title">{{ strings.SECTION.RECENT_ARTISTS }}</h2>
        <div class="artist-chips">
          @for (artist of recentArtists(); track artist.id) {
            <button type="button" class="artist-chip" (click)="navigateToArtist(artist.id)">{{ artist.name }}</button>
          }
        </div>
      </section>
    }
    <div class="filter-row">
      <input
        type="text"
        class="filter-input"
        [placeholder]="strings.PLACEHOLDER.FILTER_TRACKS"
        [ngModel]="filterText()"
        (ngModelChange)="filterText.set($event)"
      />
    </div>
    <div class="sort-row">
      <span class="sort-label">{{ strings.LABEL.SORT }}</span>
      <button type="button" class="sort-chip" [class.active]="sortBy() === 'date'" (click)="setSortBy('date')">{{ strings.SORT.DATE }}</button>
      <button type="button" class="sort-chip" [class.active]="sortBy() === 'title'" (click)="setSortBy('title')">{{ strings.SORT.TITLE }}</button>
      <button type="button" class="sort-chip" [class.active]="sortBy() === 'artist'" (click)="setSortBy('artist')">{{ strings.SORT.ARTIST }}</button>
    </div>
    @if (sortedHistory().length === 0) {
      <p class="empty">{{ strings.EMPTY.FILTER_NO_RESULTS }}</p>
    } @else {
      <ul class="track-list">
        @for (entry of sortedHistory(); track entry.playedAt) {
          <li class="track-item" (click)="playTrack(entry)" role="button" tabindex="0" (keydown.enter)="playTrack(entry)">
            <div class="track-info">
              <span class="track-title">{{ entry.track.title }}</span>
              @if (entry.track.artist) {
                <span class="track-artist">{{ entry.track.artist }}</span>
              }
            </div>
            <span class="track-duration">{{ formatDuration(entry.track.duration) }}</span>
            <span class="track-date">{{ formatDate(entry.playedAt) }}</span>
            <button
              type="button"
              class="queue-btn"
              (click)="addToQueue(entry, $event)"
              [attr.aria-label]="strings.BTN.ADD_TO_QUEUE"
              [attr.title]="strings.BTN.ADD_TO_QUEUE"
            >
              <svg class="icon-queue" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
            </button>
            <button type="button" class="track-remove-btn" (click)="removeEntry(entry); $event.stopPropagation()" [attr.aria-label]="strings.BTN.REMOVE_FROM_HISTORY" [attr.title]="strings.BTN.REMOVE_FROM_HISTORY">Ã—</button>
          </li>
        }
      </ul>
    }
  }
</div>
