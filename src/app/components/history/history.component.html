<div class="history-page">
  <header class="header">
    <h1>{{ strings.PAGE.HISTORY_TITLE }}</h1>
    <p class="subtitle">{{ strings.PAGE.HISTORY_SUBTITLE }}</p>
    @if (historyService.historyList().length > 0) {
      <button type="button" class="btn-clear" (click)="clearHistory()">{{ strings.BTN.CLEAR_HISTORY }}</button>
    }
  </header>

  @if (historyService.historyList().length === 0) {
    <p class="empty">{{ strings.EMPTY.HISTORY }}</p>
  } @else {
    <div class="sort-row">
      <span class="sort-label">{{ strings.LABEL.SORT }}</span>
      <button type="button" class="sort-chip" [class.active]="sortBy() === 'date'" (click)="setSortBy('date')">{{ strings.SORT.DATE }}</button>
      <button type="button" class="sort-chip" [class.active]="sortBy() === 'title'" (click)="setSortBy('title')">{{ strings.SORT.TITLE }}</button>
      <button type="button" class="sort-chip" [class.active]="sortBy() === 'artist'" (click)="setSortBy('artist')">{{ strings.SORT.ARTIST }}</button>
    </div>
    <ul class="track-list">
      @for (entry of sortedHistory(); track entry.playedAt) {
        <li class="track-item" (click)="playTrack(entry)" role="button" tabindex="0" (keydown.enter)="playTrack(entry)">
          <div class="track-info">
            <span class="track-title">{{ entry.track.title }}</span>
            @if (entry.track.artist) {
              <span class="track-artist">{{ entry.track.artist }}</span>
            }
          </div>
          <span class="track-duration">{{ formatDuration(entry.track.duration) }}</span>
          <span class="track-date">{{ formatDate(entry.playedAt) }}</span>
          <button type="button" class="track-remove-btn" (click)="removeEntry(entry); $event.stopPropagation()" [attr.aria-label]="strings.BTN.REMOVE_FROM_HISTORY" [attr.title]="strings.BTN.REMOVE_FROM_HISTORY">Ã—</button>
        </li>
      }
    </ul>
  }
</div>
